<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskVault - Your Secondary Brain</title>
    <meta name="description" content="Store and organize links, images, and contextual information with deadline tracking">
    <meta name="theme-color" content="#1E90FF">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="TaskVault">
    <link rel="manifest" href="./manifest.json">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .task-item { transition: all 0.2s ease; }
        .task-item:hover { transform: translateY(-1px); }
        .completed { opacity: 0.6; text-decoration: line-through; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div id="root"></div>
    
    <script>
        const { useState, useEffect, createElement: e } = React;
        
        // Local Storage Manager
        class TaskStorage {
            constructor() {
                this.storageKey = 'taskvault-tasks';
                this.tasks = this.loadTasks();
                this.nextId = Math.max(...this.tasks.map(t => t.id), 0) + 1;
            }
            
            loadTasks() {
                try {
                    const stored = localStorage.getItem(this.storageKey);
                    return stored ? JSON.parse(stored) : [];
                } catch (error) {
                    return [];
                }
            }
            
            saveTasks() {
                localStorage.setItem(this.storageKey, JSON.stringify(this.tasks));
            }
            
            getAllTasks() {
                return this.tasks.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            }
            
            getTasksByCategory(category) {
                if (category === 'all') return this.getAllTasks();
                return this.tasks.filter(t => t.category === category)
                    .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            }
            
            addTask(title, url, context, category, deadline) {
                const task = {
                    id: this.nextId++,
                    title,
                    url: url || null,
                    context,
                    category,
                    deadline: deadline || null,
                    completed: false,
                    createdAt: new Date().toISOString(),
                    completedAt: null
                };
                this.tasks.push(task);
                this.saveTasks();
                return task;
            }
            
            toggleComplete(id) {
                const task = this.tasks.find(t => t.id === id);
                if (task) {
                    task.completed = !task.completed;
                    task.completedAt = task.completed ? new Date().toISOString() : null;
                    this.saveTasks();
                }
                return task;
            }
            
            deleteTask(id) {
                this.tasks = this.tasks.filter(t => t.id !== id);
                this.saveTasks();
            }
            
            getStats() {
                const total = this.tasks.length;
                const completed = this.tasks.filter(t => t.completed).length;
                const pending = total - completed;
                const overdue = this.tasks.filter(t => 
                    !t.completed && t.deadline && new Date(t.deadline) < new Date()
                ).length;
                return { total, pending, completed, overdue };
            }
        }
        
        const storage = new TaskStorage();
        
        // Header Component
        function Header({ searchQuery, onSearchChange }) {
            return e('div', { className: 'bg-white shadow-sm border-b p-4' },
                e('div', { className: 'flex items-center justify-between mb-4' },
                    e('h1', { className: 'text-2xl font-bold text-gray-900' }, 'TaskVault'),
                    e('div', { className: 'text-sm text-gray-500' }, 'Your Secondary Brain')
                ),
                e('input', {
                    type: 'text',
                    placeholder: 'Search tasks...',
                    value: searchQuery,
                    onChange: (e) => onSearchChange(e.target.value),
                    className: 'w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent'
                })
            );
        }
        
        // Stats Component
        function StatsOverview() {
            const [stats, setStats] = useState({ total: 0, pending: 0, completed: 0, overdue: 0 });
            
            useEffect(() => {
                setStats(storage.getStats());
            }, []);
            
            const refreshStats = () => setStats(storage.getStats());
            
            return e('div', { className: 'p-4 bg-white mx-4 mt-4 rounded-lg shadow-sm grid grid-cols-4 gap-4' },
                e('div', { className: 'text-center' },
                    e('div', { className: 'text-2xl font-bold text-blue-600' }, stats.total),
                    e('div', { className: 'text-sm text-gray-500' }, 'Total')
                ),
                e('div', { className: 'text-center' },
                    e('div', { className: 'text-2xl font-bold text-orange-600' }, stats.pending),
                    e('div', { className: 'text-sm text-gray-500' }, 'Pending')
                ),
                e('div', { className: 'text-center' },
                    e('div', { className: 'text-2xl font-bold text-green-600' }, stats.completed),
                    e('div', { className: 'text-sm text-gray-500' }, 'Done')
                ),
                e('div', { className: 'text-center' },
                    e('div', { className: 'text-2xl font-bold text-red-600' }, stats.overdue),
                    e('div', { className: 'text-sm text-gray-500' }, 'Overdue')
                )
            );
        }
        
        // Category Tabs Component
        function CategoryTabs({ selectedCategory, onCategoryChange }) {
            const categories = [
                { id: 'all', label: 'All', icon: 'ðŸ“‹' },
                { id: 'link', label: 'Links', icon: 'ðŸ”—' },
                { id: 'video', label: 'Videos', icon: 'ðŸ“¹' },
                { id: 'image', label: 'Images', icon: 'ðŸ–¼ï¸' },
                { id: 'article', label: 'Articles', icon: 'ðŸ“„' }
            ];
            
            return e('div', { className: 'flex overflow-x-auto p-4 space-x-2' },
                ...categories.map(cat =>
                    e('button', {
                        key: cat.id,
                        onClick: () => onCategoryChange(cat.id),
                        className: `flex items-center space-x-2 px-4 py-2 rounded-full text-sm font-medium transition-colors ${
                            selectedCategory === cat.id
                                ? 'bg-blue-500 text-white'
                                : 'bg-white text-gray-700 border border-gray-300 hover:bg-gray-50'
                        }`
                    },
                        e('span', null, cat.icon),
                        e('span', null, cat.label)
                    )
                )
            );
        }
        
        // Task Item Component
        function TaskItem({ task, onToggle, onDelete }) {
            return e('div', { className: `task-item bg-white rounded-lg shadow-sm border p-4 mb-3 ${task.completed ? 'completed' : ''}` },
                e('div', { className: 'flex items-start justify-between' },
                    e('div', { className: 'flex-1' },
                        e('h3', { className: 'font-medium text-gray-900 mb-1' }, task.title),
                        e('p', { className: 'text-gray-600 text-sm mb-2' }, task.context),
                        task.url && e('a', {
                            href: task.url,
                            target: '_blank',
                            rel: 'noopener noreferrer',
                            className: 'text-blue-500 text-sm hover:underline'
                        }, task.url),
                        task.deadline && e('div', { className: 'text-sm text-gray-500 mt-2' },
                            'â° ', new Date(task.deadline).toLocaleDateString()
                        )
                    ),
                    e('div', { className: 'flex items-center space-x-2 ml-4' },
                        e('button', {
                            onClick: () => onToggle(task.id),
                            className: `px-3 py-1 rounded text-sm ${
                                task.completed
                                    ? 'bg-green-100 text-green-800'
                                    : 'bg-gray-100 text-gray-800 hover:bg-gray-200'
                            }`
                        }, task.completed ? 'âœ“ Done' : 'Mark Done'),
                        e('button', {
                            onClick: () => onDelete(task.id),
                            className: 'px-3 py-1 bg-red-100 text-red-800 rounded text-sm hover:bg-red-200'
                        }, 'ðŸ—‘ï¸')
                    )
                )
            );
        }
        
        // Add Task Form Component
        function AddTaskForm({ onAdd, onCancel }) {
            const [title, setTitle] = useState('');
            const [url, setUrl] = useState('');
            const [context, setContext] = useState('');
            const [category, setCategory] = useState('link');
            const [deadline, setDeadline] = useState('');
            
            const handleSubmit = (e) => {
                e.preventDefault();
                if (title.trim()) {
                    onAdd(title.trim(), url.trim(), context.trim(), category, deadline || null);
                    setTitle('');
                    setUrl('');
                    setContext('');
                    setCategory('link');
                    setDeadline('');
                    onCancel();
                }
            };
            
            return e('div', { className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50' },
                e('div', { className: 'bg-white rounded-lg p-6 w-full max-w-md' },
                    e('h2', { className: 'text-xl font-bold mb-4' }, 'Add New Task'),
                    e('form', { onSubmit: handleSubmit },
                        e('input', {
                            type: 'text',
                            placeholder: 'Task title *',
                            value: title,
                            onChange: (e) => setTitle(e.target.value),
                            className: 'w-full px-3 py-2 border border-gray-300 rounded mb-3 focus:ring-2 focus:ring-blue-500',
                            required: true
                        }),
                        e('input', {
                            type: 'url',
                            placeholder: 'URL (optional)',
                            value: url,
                            onChange: (e) => setUrl(e.target.value),
                            className: 'w-full px-3 py-2 border border-gray-300 rounded mb-3 focus:ring-2 focus:ring-blue-500'
                        }),
                        e('textarea', {
                            placeholder: 'Context/Notes',
                            value: context,
                            onChange: (e) => setContext(e.target.value),
                            className: 'w-full px-3 py-2 border border-gray-300 rounded mb-3 focus:ring-2 focus:ring-blue-500',
                            rows: 3
                        }),
                        e('select', {
                            value: category,
                            onChange: (e) => setCategory(e.target.value),
                            className: 'w-full px-3 py-2 border border-gray-300 rounded mb-3 focus:ring-2 focus:ring-blue-500'
                        },
                            e('option', { value: 'link' }, 'ðŸ”— Link'),
                            e('option', { value: 'video' }, 'ðŸ“¹ Video'),
                            e('option', { value: 'image' }, 'ðŸ–¼ï¸ Image'),
                            e('option', { value: 'article' }, 'ðŸ“„ Article')
                        ),
                        e('input', {
                            type: 'date',
                            placeholder: 'Deadline (optional)',
                            value: deadline,
                            onChange: (e) => setDeadline(e.target.value),
                            className: 'w-full px-3 py-2 border border-gray-300 rounded mb-4 focus:ring-2 focus:ring-blue-500'
                        }),
                        e('div', { className: 'flex space-x-3' },
                            e('button', {
                                type: 'submit',
                                className: 'flex-1 bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600'
                            }, 'Add Task'),
                            e('button', {
                                type: 'button',
                                onClick: onCancel,
                                className: 'flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded hover:bg-gray-400'
                            }, 'Cancel')
                        )
                    )
                )
            );
        }
        
        // Main App Component
        function App() {
            const [tasks, setTasks] = useState([]);
            const [searchQuery, setSearchQuery] = useState('');
            const [selectedCategory, setSelectedCategory] = useState('all');
            const [showAddForm, setShowAddForm] = useState(false);
            
            const refreshTasks = () => {
                setTasks(storage.getTasksByCategory(selectedCategory));
            };
            
            useEffect(() => {
                refreshTasks();
            }, [selectedCategory]);
            
            const filteredTasks = tasks.filter(task =>
                task.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
                task.context.toLowerCase().includes(searchQuery.toLowerCase())
            );
            
            const handleAddTask = (title, url, context, category, deadline) => {
                storage.addTask(title, url, context, category, deadline);
                refreshTasks();
            };
            
            const handleToggleTask = (id) => {
                storage.toggleComplete(id);
                refreshTasks();
            };
            
            const handleDeleteTask = (id) => {
                if (confirm('Are you sure you want to delete this task?')) {
                    storage.deleteTask(id);
                    refreshTasks();
                }
            };
            
            return e('div', { className: 'min-h-screen bg-gray-50' },
                e(Header, { searchQuery, onSearchChange: setSearchQuery }),
                e(StatsOverview),
                e(CategoryTabs, { selectedCategory, onCategoryChange: setSelectedCategory }),
                
                // Add Task Button
                e('div', { className: 'p-4' },
                    e('button', {
                        onClick: () => setShowAddForm(true),
                        className: 'w-full bg-blue-500 text-white py-3 px-4 rounded-lg text-center font-medium hover:bg-blue-600'
                    }, '+ Add New Task')
                ),
                
                // Task List
                e('div', { className: 'px-4 pb-20' },
                    filteredTasks.length === 0
                        ? e('div', { className: 'text-center text-gray-500 py-8' },
                            searchQuery
                                ? 'No tasks match your search.'
                                : selectedCategory === 'all'
                                    ? 'No tasks yet. Add your first task above!'
                                    : `No ${selectedCategory} tasks yet.`
                        )
                        : filteredTasks.map(task =>
                            e(TaskItem, {
                                key: task.id,
                                task,
                                onToggle: handleToggleTask,
                                onDelete: handleDeleteTask
                            })
                        )
                ),
                
                // Add Task Form Modal
                showAddForm && e(AddTaskForm, {
                    onAdd: handleAddTask,
                    onCancel: () => setShowAddForm(false)
                })
            );
        }
        
        // Render the app
        ReactDOM.render(e(App), document.getElementById('root'));
    </script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => console.log('SW registered'))
                    .catch(error => console.log('SW registration failed'));
            });
        }
    </script>
</body>
</html>